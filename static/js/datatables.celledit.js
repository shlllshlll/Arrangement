define(["jquery","datatables.net"],function(e){jQuery.fn.dataTable.Api.register("MakeCellsEditable()",function(t){var a=this.table();jQuery.fn.extend({updateEditableCell:function(a){var l=e(a).closest("table").DataTable().table(),i=l.row(e(a).parents("tr")),s=l.cell(e(a).parent()),n=s.index().column,c=function(t){var a;switch(e(t).prop("nodeName").toLowerCase()){case"a":e(t).siblings("input").length>0&&(a=e(t).siblings("input")),e(t).siblings("select").length>0&&(a=e(t).siblings("select")),e(t).siblings("textarea").length>0&&(a=e(t).siblings("textarea"));break;default:a=e(t)}return a}(a),o=c.val();function r(){t.allowNulls.errorClass?e(c).addClass(t.allowNulls.errorClass):e(c).css({border:"red solid 1px"})}function u(e){var a=s.data();s.data(e),t.onUpdate(s,i,a)}!o&&t.allowNulls&&1!=t.allowNulls?t.allowNulls.columns?t.allowNulls.columns.indexOf(n)>-1?u(o):r():o||r():u(o);var d=l.page.info().page;l.page(d).draw(!1)},cancelEditableCell:function(t){var a=e(t.closest("table")).DataTable().table(),l=a.cell(e(t).parent());l.data(l.data()),a.draw()}}),"destroy"===t&&(e(a.body()).off("click","td"),a=null),null!=a&&e(a.body()).on("click","td",function(){var l=a.cell(this).index().column;if(t.columns&&t.columns.indexOf(l)>-1||!t.columns){var i=a.row(e(this).parents("tr"));editableCellsRow=i;var s=a.cell(this).node(),n=a.cell(this).data();if(n=function(e){if(null==e||e.length<1)return"";isNaN(e)&&(e=e.replace(/'/g,"&#39;"));return e}(n),!e(s).find("input").length&&!e(s).find("select").length&&!e(s).find("textarea").length){var c=function(t,a,l){var i,s,n,c,o,r;n={focus:!0,html:null},a.inputTypes&&e.each(a.inputTypes,function(e,a){a.column==t&&(s=(i=a).type.toLowerCase())});a.inputCss&&(c=a.inputCss);a.confirmationButton&&(o=a.confirmationButton.confirmCss,r=a.confirmationButton.cancelCss,s+="-confirm");switch(s){case"list":n.html="<select class='"+c+"' onchange='$(this).updateEditableCell(this);'>",e.each(i.options,function(e,t){l==t.value?n.html=n.html+"<option value='"+t.value+"' selected>"+t.display+"</option>":n.html=n.html+"<option value='"+t.value+"' >"+t.display+"</option>"}),n.html=n.html+"</select>",n.focus=!1;break;case"list-confirm":n.html="<select class='"+c+"'>",e.each(i.options,function(e,t){l==t.value?n.html=n.html+"<option value='"+t.value+"' selected>"+t.display+"</option>":n.html=n.html+"<option value='"+t.value+"' >"+t.display+"</option>"}),n.html=n.html+"</select>&nbsp;<a href='javascript:void(0);' class='"+o+"' onclick='$(this).updateEditableCell(this);'>Confirm</a> <a href='javascript:void(0);' class='"+r+"' onclick='$(this).cancelEditableCell(this)'>Cancel</a> ",n.focus=!1;break;case"datepicker":case"datepicker-confirm":if(void 0===jQuery.ui){alert("jQuery UI is required for the DatePicker control but it is not loaded on the page!");break}jQuery(".datepick").datepicker("destroy"),n.html="<input id='ejbeatycelledit' type='text' name='date' class='datepick "+c+"'   value='"+l+"'></input> &nbsp;<a href='javascript:void(0);' class='"+o+"' onclick='$(this).updateEditableCell(this)'>Confirm</a> <a href='javascript:void(0);' class='"+r+"' onclick='$(this).cancelEditableCell(this)'>Cancel</a>",setTimeout(function(){var e="http://jqueryui.com/resources/demos/datepicker/images/calendar.gif";void 0!==i.options&&void 0!==i.options.icon&&(e=i.options.icon);jQuery(".datepick").datepicker({showOn:"button",buttonImage:e,buttonImageOnly:!0,buttonText:"Select date"})},100);break;case"text-confirm":case"undefined-confirm":n.html="<input id='ejbeatycelledit' class='"+c+"' value='"+l+"'></input>&nbsp;<a href='javascript:void(0);' class='"+o+"' onclick='$(this).updateEditableCell(this)'>Confirm</a> <a href='javascript:void(0);' class='"+r+"' onclick='$(this).cancelEditableCell(this)'>Cancel</a> ";break;case"textarea":case"textarea-confirm":n.html="<textarea id='ejbeatycelledit' class='"+c+"'>"+l+"</textarea><a href='javascript:void(0);' class='"+o+"' onclick='$(this).updateEditableCell(this)'>Confirm</a> <a href='javascript:void(0);' class='"+r+"' onclick='$(this).cancelEditableCell(this)'>Cancel</a>";break;default:n.html="<input id='ejbeatycelledit' class='"+c+"' onfocusout='$(this).updateEditableCell(this)' value='"+l+"'></input>"}return n}(l,t,n);e(s).html(c.html),c.focus&&e("#ejbeatycelledit").focus()}}})})});